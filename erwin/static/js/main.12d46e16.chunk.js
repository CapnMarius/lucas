(this["webpackJsonperwin-spotify"]=this["webpackJsonperwin-spotify"]||[]).push([[0],{170:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n(0),o=n(15),i=n.n(o),s=n(241),c=n(240),l=n(114),u=n(20),d=n(99),p=n(7),h=n.n(p),j=n(14),m=n(26),v=n(43),b=n(77),f=n(9),g=n(102),x=n.n(g),O=function(){function e(t,n){Object(v.a)(this,e),this.api=null,this.spotifyStore=null,this.hostOrGuest=null,this.room=null,this.username=null,this.memories=[],this.socket=null,this.guests=0,this.songIdForMemory=null,this.popup=null,x()(this),this.api=t,this.spotifyStore=n}return Object(b.a)(e,[{key:"initialize",value:function(){var e=function(){var e=window.location.href;if(e.includes("?code")){var t=e.split("?code=")[1];return window.history.replaceState({},"",window.location.origin),t}}();e&&this.createRoom(e)}},{key:"initializeSocket",value:function(){var e=this;this.socket=this.api.getSocket(),this.socket.onopen=function(){e.sendMessage("SET_CLIENT_META",{room:e.room.code,hostOrGuest:e.hostOrGuest})},this.socket.onmessage=function(t){var n=JSON.parse(t.data);console.log("Received: '"+t.data+"'"),e.handleMessage(n.action,n)},this.spotifyStore.initialize(this.room,this.hostOrGuest,this.socket)}},{key:"handleMessage",value:function(e,t){this.isHost&&this.handleMessageFromGuest(e,t),this.isGuest&&this.handleMessageFromHost(e,t)}},{key:"handleMessageFromGuest",value:function(e,t){if("UPDATE_GUEST_COUNT"===e){var n=t.count;this.guests=Number(n)}"NEW_MEMORY"===e&&this.getMemories()}},{key:"handleMessageFromHost",value:function(e,t){if("ROOM_CLOSED"===e&&window.location.reload(),"PLAYLIST_SET"===e){var n=t.playlist_id;this.spotifyStore.setPlaylist(n)}}},{key:"sendMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.socket.send(JSON.stringify(Object(m.a)({action:e,from:this.hostOrGuest},t)))}},{key:"leaveRoom",value:function(){var e;this.room=null,this.username=null,this.hostOrGuest=null,null===(e=this.socket)||void 0===e||e.close(),this.socket=null}},{key:"closeRoom",value:function(){var e=Object(j.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.location.reload();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"createRoom",value:function(){var e=Object(j.a)(h.a.mark((function e(t){var n,a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=window.localStorage.getItem("code"),r=window.localStorage.getItem("name"),e.prev=2,e.next=5,this.api.createRoom({code:t,room:{code:a,name:r}});case 5:n=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log("\ud83e\uddd9\u200d\u2642\ufe0f",e.t0);case 11:if(window.localStorage.removeItem("code"),window.localStorage.removeItem("name"),n){e.next=17;break}return this.room=null,this.hostOrGuest=null,e.abrupt("return");case 17:this.room=n,this.hostOrGuest="host",this.initializeSocket();case 20:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"generateRoom",value:function(){var e=Object(j.a)(h.a.mark((function e(t){var n,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Math.floor(9e4*Math.random())+1e4,window.localStorage.setItem("name",t),window.localStorage.setItem("code",n),e.next=5,this.api.oauth();case 5:a=e.sent,window.location=a;case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"joinRoom",value:function(){var e=Object(j.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.api.getRoom({code:n});case 3:a=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log("\ud83e\uddd9\u200d\u2642\ufe0f",e.t0);case 9:this.room=a,this.username=t,this.hostOrGuest="guest",this.initializeSocket();case 13:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"openAddMemoryPopup",value:function(e){this.songIdForMemory=e,this.popup="addMemory"}},{key:"closeAddMemoryPopup",value:function(){this.popup=null,this.songIdForMemory=null}},{key:"addMemory",value:function(){var e=Object(j.a)(h.a.mark((function e(t){var n,a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.text,a=t.file,e.prev=1,e.next=4,this.api.saveMemory({room_code:this.room.code,song_id:this.songIdForMemory,user:this.username,text:n,filename:a.name});case 4:return r=e.sent,e.next=7,this.api.saveMemoryImage({upload_url:r,file:a});case 7:this.sendMessage("NEW_MEMORY"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.log("\ud83e\uddd9\u200d\u2642\ufe0f",e.t0);case 13:case"end":return e.stop()}}),e,this,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteMemory",value:function(){var e=Object(j.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.api.deleteMemory({room_code:this.room.code,memory_id:t});case 3:this.memories=this.memories.filter((function(e){return(null===e||void 0===e?void 0:e.pk)!==t})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log("\ud83e\uddd9\u200d\u2642\ufe0f",e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getMemories",value:function(){var e=Object(j.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.api.getMemories({room_code:this.room.code});case 3:this.memories=e.sent,console.log(JSON.parse(JSON.stringify(this.memories))),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("\ud83e\uddd9\u200d\u2642\ufe0f",e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"setSelectedSong",value:function(e){this.songIdForMemory=e}},{key:"nav",get:function(){return this.hostOrGuest?"host"===this.hostOrGuest?"host":"guest":"landing_page"}},{key:"isHost",get:function(){return"host"===this.hostOrGuest}},{key:"isGuest",get:function(){return"guest"===this.hostOrGuest}},{key:"selectedSong",get:function(){var e=this;return this.spotifyStore.songs.find((function(t){return t.id===e.songIdForMemory}))}}]),e}();Object(f.e)(O,{hostOrGuest:f.g,username:f.g,room:f.g,guests:f.g,memories:f.g,songIdForMemory:f.g,popup:f.g,initialize:f.b,createRoom:f.b,leaveRoom:f.b,openAddMemoryPopup:f.b,closeAddMemoryPopup:f.b,deleteMemory:f.b,setSelectedSong:f.b,nav:f.c,isHost:f.c,isGuest:f.c,selectedSong:f.c});var y=function(){function e(t,n){var a=this;Object(v.a)(this,e),this.initialize=function(){var e=Object(j.a)(h.a.mark((function e(t,n,r){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.token=t.access_token,a.room_code=t.code,a.hostOrGuest=n,a.isHost&&(a.socket=r,a.preparePlayer(),a.getPlaylists()),a.isGuest&&t.playlist_id&&a.setPlaylist(t.playlist_id);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),this.preparePlayer=function(){return new Promise((function(e,t){if(window.onSpotifyWebPlaybackSDKReady?a.startPlayer():window.onSpotifyWebPlaybackSDKReady=a.startPlayer,document.getElementById("spotify-player"))e();else{var n=document.createElement("script");n.id="spotify-player",n.type="text/javascript",n.async=!1,n.defer=!0,n.src="https://sdk.scdn.co/spotify-player.js",n.onload=function(){return e()},n.onerror=function(e){return t(new Error("loadScript: ".concat(e.message)))},document.head.appendChild(n)}}))},this.startPlayer=function(){a.player=new window.Spotify.Player({getOAuthToken:function(e){e(a.token)},name:"Playlist Memories",volume:1}),a.player.addListener("ready",(function(e){a.device_id=e.device_id})),a.player.addListener("not_ready",(function(e){console.log("not_ready",e)})),a.player.addListener("player_state_changed",(function(e){a.player_state=e})),a.player.addListener("initialization_error",(function(e){return console.log("initialization_error",e.message)})),a.player.addListener("authentication_error",(function(e){return console.log("authentication_error",e.message)})),a.player.addListener("account_error",(function(e){return console.log("account_error",e.message)})),a.player.addListener("playback_error",(function(e){return console.log("playback_error",e.message)})),a.player.connect()},this.getPlaylists=Object(j.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.api.getPlaylists({room_code:a.room_code});case 3:a.playlists=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0,"Failed to get playlists!");case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))),this.setPlaylist=function(){var e=Object(j.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.isHost){e.next=8;break}return e.next=3,a.api.setPlaylist({room_code:a.room_code,playlist_id:t});case 3:if(e.sent){e.next=7;break}return console.log("\ud83d\udc72","Failed to set playlist in room!!"),e.abrupt("return");case 7:a.sendMessage("PLAYLIST_SET",{playlist_id:t});case 8:a.playlist_id=t,t&&a.getSongs();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getSongs=Object(j.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.songs=[],e.prev=1,e.next=4,a.api.getSongs({room_code:a.room_code});case 4:a.songs=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.error(e.t0,"Failed to get songs!");case 10:case"end":return e.stop()}}),e,null,[[1,7]])}))),this.playSong=function(){var e=Object(j.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.spotify_api.playSong({device_id:a.device_id,token:a.token,uri:t});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0,"Failed to play song!");case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),this.queueSong=function(){var e=Object(j.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.spotify_api.queueSong({device_id:a.device_id,token:a.token,uri:t});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0,"Failed to queue song!");case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),this.togglePlayback=Object(j.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.spotify_api.togglePlayback({playback:a.paused?"play":"pause",device_id:a.device_id,token:a.token});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0,"Failed to toggle playback!");case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),this.nextSong=Object(j.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.spotify_api.next({device_id:a.device_id,token:a.token});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0,"Failed to toggle playback!");case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),this.setCurrentSong=function(e){a.player_state={track_window:{current_track:{id:e}}}},this.api=t,this.spotify_api=n,this.token=null,this.room_code=null,this.player=null,this.device_id=null,this.player_state=null,this.playlists=[],this.playlist_id=null,this.songs=[],this.song_id=null,this.socket=null,this.hostOrGuest=null}return Object(b.a)(e,[{key:"sendMessage",value:function(e,t){this.socket.send(JSON.stringify(Object(m.a)({action:e,from:this.hostOrGuest},t)))}},{key:"paused",get:function(){var e,t;return null===(e=null===(t=this.player_state)||void 0===t?void 0:t.paused)||void 0===e||e}},{key:"current_song",get:function(){var e=this;return this.songs.find((function(t){var n,a,r;return t.id===(null===(n=e.player_state)||void 0===n||null===(a=n.track_window)||void 0===a||null===(r=a.current_track)||void 0===r?void 0:r.id)}))}},{key:"playlist",get:function(){var e,t=this;return null===(e=this.playlists)||void 0===e?void 0:e.find((function(e){return(null===e||void 0===e?void 0:e.id)===t.playlist_id}))}},{key:"isHost",get:function(){return"host"===this.hostOrGuest}},{key:"isGuest",get:function(){return"guest"===this.hostOrGuest}}]),e}();Object(f.e)(y,{token:f.g,player:f.g,device_id:f.g,player_state:f.g,playlists:f.g,playlist_id:f.g,room_code:f.g,songs:f.g,song_id:f.g,initialize:f.b,startPlayer:f.b,getPlaylists:f.b,setPlaylist:f.b,getSongs:f.b,setSong:f.b,setCurrentSong:f.b,goBack:f.b,paused:f.c,current_song:f.c,isHost:f.c,isGuest:f.c});var k=n(22),w=n.n(k),_=function e(){var t=this;Object(v.a)(this,e),this.playSong=function(){var e=Object(j.a)(h.a.mark((function e(n){var a,r,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.token,r=n.device_id,o=n.uri,e.next=3,w.a.put("".concat(t.base,"/me/player/play")).set({Authorization:"Bearer ".concat(a)}).query({device_id:r}).send({uris:[o]});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.queueSong=function(){var e=Object(j.a)(h.a.mark((function e(n){var a,r,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.token,r=n.device_id,o=n.uri,e.next=3,w.a.post("".concat(t.base,"/me/player/queue")).set({Authorization:"Bearer ".concat(a)}).query({device_id:r,uri:o});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.togglePlayback=function(){var e=Object(j.a)(h.a.mark((function e(n){var a,r,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.token,r=n.device_id,o=n.playback,e.next=3,w.a.put("".concat(t.base,"/me/player/").concat(o)).set({Authorization:"Bearer ".concat(a)}).query({device_id:r});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.next=function(){var e=Object(j.a)(h.a.mark((function e(n){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.token,r=n.device_id,e.next=3,w.a.post("".concat(t.base,"/me/player/next")).set({Authorization:"Bearer ".concat(a)}).query({device_id:r});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.base="https://api.spotify.com/v1"},S=n(116),M=n(34),N=new function e(){var t=this;Object(v.a)(this,e),this.getSocket=function(){return new WebSocket("".concat("development"===M.a.NODE_ENV?"ws":"wss","://").concat("development"===M.a.NODE_ENV?M.a.BACKEND_BASE_DEV:M.a.BACKEND_BASE_PRD))},this.oauth=Object(j.a)(h.a.mark((function e(){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.a.get("".concat(t.base,"/authorize"));case 3:return n=e.sent,e.abrupt("return",null===n||void 0===n?void 0:n.text);case 7:e.prev=7,e.t0=e.catch(0),console.log("\ud83d\udc51",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),this.getRoom=function(){var e=Object(j.a)(h.a.mark((function e(n){var a,r,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.code,e.prev=1,e.next=4,w.a.get("".concat(t.base,"/room/").concat(a));case 4:return o=e.sent,e.abrupt("return",null===o||void 0===o||null===(r=o.body)||void 0===r?void 0:r.room);case 8:e.prev=8,e.t0=e.catch(1),console.log("\ud83e\uddb8\u200d\u2642\ufe0f",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),this.createRoom=function(){var e=Object(j.a)(h.a.mark((function e(n){var a,r,o,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.room,r=n.code,e.prev=1,e.next=4,w.a.post("".concat(t.base,"/room")).send({room:a,code:r});case 4:return i=e.sent,e.abrupt("return",null===i||void 0===i||null===(o=i.body)||void 0===o?void 0:o.room);case 8:e.prev=8,e.t0=e.catch(1),console.log("\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),this.getPlaylists=function(){var e=Object(j.a)(h.a.mark((function e(n){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.room_code,e.prev=1,e.next=4,w.a.get("".concat(t.base,"/room/").concat(a,"/playlists"));case 4:return r=e.sent,e.abrupt("return",r.body||[]);case 8:e.prev=8,e.t0=e.catch(1),console.log("\ud83d\udc41",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),this.setPlaylist=function(){var e=Object(j.a)(h.a.mark((function e(n){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.room_code,r=n.playlist_id,e.prev=1,e.next=4,w.a.put("".concat(t.base,"/room/").concat(a,"/playlist")).send({playlist_id:r});case 4:return e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(1),console.log("\ud83d\udc41",e.t0),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}(),this.getSongs=function(){var e=Object(j.a)(h.a.mark((function e(n){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.room_code,e.prev=1,e.next=4,w.a.get("".concat(t.base,"/room/").concat(a,"/songs"));case 4:return r=e.sent,e.abrupt("return",(null===r||void 0===r?void 0:r.body)||[]);case 8:e.prev=8,e.t0=e.catch(1),console.log("\ud83d\udc42",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),this.getMemories=function(){var e=Object(j.a)(h.a.mark((function e(n){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.room_code,e.prev=1,e.next=4,w.a.get("".concat(t.base,"/room/").concat(a,"/memories"));case 4:return r=e.sent,e.abrupt("return",(null===r||void 0===r?void 0:r.body)||[]);case 8:e.prev=8,e.t0=e.catch(1),console.log("\ud83d\ude4f",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),this.saveMemory=function(){var e=Object(j.a)(h.a.mark((function e(n){var a,r,o,i,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.room_code,r=n.song_id,o=Object(S.a)(n,["room_code","song_id"]),e.prev=1,e.next=4,w.a.put("".concat(t.base,"/room/").concat(a,"/memories")).send(Object(m.a)(Object(m.a)({},o),{},{song_id:r}));case 4:return s=e.sent,e.abrupt("return",null===s||void 0===s||null===(i=s.body)||void 0===i?void 0:i.upload_url);case 8:e.prev=8,e.t0=e.catch(1),console.log("\ud83d\ude4f",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),this.saveMemoryImage=function(){var e=Object(j.a)(h.a.mark((function e(t){var n,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.file,a=t.upload_url,e.prev=1,e.next=4,w.a.put(a).set("Content-Type",n.type).send(n);case 4:return e.abrupt("return",!0);case 7:e.prev=7,e.t0=e.catch(1),console.log("\ud83d\ude4f",e.t0.response);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}(),this.deleteMemory=function(){var e=Object(j.a)(h.a.mark((function e(n){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.room_code,r=n.memory_id,e.prev=1,e.next=4,w.a.delete("".concat(t.base,"/room/").concat(a,"/memories/").concat(r));case 4:return e.abrupt("return",!0);case 7:e.prev=7,e.t0=e.catch(1),console.log("\ud83d\ude4f",e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}(),this.base="development"===M.a.NODE_ENV?"".concat(M.a.PROTOCOL_DEV,"://").concat(M.a.BACKEND_BASE_DEV):"".concat(M.a.PROTOCOL_PRD,"://").concat(M.a.BACKEND_BASE_PRD)},C=new y(N,new _),P=new O(N,C),E=Object(r.createContext)({applicationStore:P,spotifyStore:C}),G=function(){return Object(r.useContext)(E)},R=n(27),z=n(52),F=n(210),I=n(246),A=n(212),T=n(213),B=n(211),D=n(215),W=n(214),L=n(242),J=n(79),q=function(){var e=Object(J.useMediaQuery)({minWidth:1280}),t=Object(J.useMediaQuery)({minWidth:960}),n=Object(J.useMediaQuery)({minWidth:600});return e?"large":t?"medium":n?"small":"mobile"},H=Object(F.a)((function(e){return{dialog:Object(z.a)({},e.breakpoints.up("sm"),{width:"34rem",height:"15rem"})}})),K=function(e){var t=e.onCreate,n=e.onJoin;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(B.a,{children:"Playlist Memories"}),Object(a.jsx)(A.a,{children:"Share the memories you've made with a song from your favorite playlist!"}),Object(a.jsx)(T.a,{children:Object(a.jsxs)(W.a,{container:!0,spacing:2,children:[Object(a.jsx)(W.a,{item:!0,xs:6,children:Object(a.jsx)(D.a,{fullWidth:!0,size:"medium",color:"primary",variant:"contained",onClick:t,children:"Create room"})}),Object(a.jsx)(W.a,{item:!0,xs:6,children:Object(a.jsx)(D.a,{fullWidth:!0,size:"medium",color:"primary",variant:"contained",onClick:n,children:"Join room"})})]})})]})},U=function(e){var t=e.onCreate,n=e.onGoBack,o=Object(r.useState)(""),i=Object(R.a)(o,2),s=i[0],c=i[1];return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(B.a,{children:"Create room"}),Object(a.jsx)(A.a,{children:Object(a.jsx)(L.a,{fullWidth:!0,variant:"outlined",size:"small",label:"Room name",onChange:function(e){c(e.target.value)},value:s})}),Object(a.jsx)(T.a,{children:Object(a.jsxs)(W.a,{container:!0,spacing:2,children:[Object(a.jsx)(W.a,{item:!0,xs:6,children:Object(a.jsx)(D.a,{fullWidth:!0,size:"medium",color:"secondary",variant:"contained",onClick:n,children:"Go back"})}),Object(a.jsx)(W.a,{item:!0,xs:6,children:Object(a.jsx)(D.a,{fullWidth:!0,size:"medium",color:"primary",variant:"contained",disabled:!s,onClick:function(){t(s)},children:"Create room"})})]})})]})},V=function(e){var t=e.onJoin,n=e.onGoBack,o=Object(r.useState)(""),i=Object(R.a)(o,2),s=i[0],c=i[1],l=Object(r.useState)(""),u=Object(R.a)(l,2),d=u[0],p=u[1];return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(B.a,{children:"Join room"}),Object(a.jsx)(A.a,{children:Object(a.jsxs)(W.a,{container:!0,spacing:2,children:[Object(a.jsx)(W.a,{item:!0,xs:12,children:Object(a.jsx)(L.a,{fullWidth:!0,variant:"outlined",size:"small",label:"Username",onChange:function(e){c(e.target.value)},value:s})}),Object(a.jsx)(W.a,{item:!0,xs:12,children:Object(a.jsx)(L.a,{fullWidth:!0,variant:"outlined",size:"small",label:"Room code",onChange:function(e){p(e.target.value)},value:d})})]})}),Object(a.jsx)(T.a,{children:Object(a.jsxs)(W.a,{container:!0,spacing:2,children:[Object(a.jsx)(W.a,{item:!0,xs:6,children:Object(a.jsx)(D.a,{fullWidth:!0,size:"medium",color:"secondary",variant:"contained",onClick:n,children:"Go back"})}),Object(a.jsx)(W.a,{item:!0,xs:6,children:Object(a.jsx)(D.a,{fullWidth:!0,size:"medium",color:"primary",variant:"contained",disabled:!s||5!==(null===d||void 0===d?void 0:d.length),onClick:function(){t(s,d)},children:"Join room"})})]})})]})},Y=Object(u.a)((function(){var e=G().applicationStore,t=e.generateRoom,n=e.joinRoom,o=H(),i=q(),s=Object(r.useState)("initial"),c=Object(R.a)(s,2),l=c[0],u=c[1];return Object(a.jsxs)(I.a,{onClose:function(){},open:!0,fullScreen:"mobile"===i,classes:{paper:o.dialog},children:["initial"===l&&Object(a.jsx)(K,{onCreate:function(){return u("create")},onJoin:function(){return u("join")}}),"create"===l&&Object(a.jsx)(U,{onCreate:function(e){return t(e)},onGoBack:function(){return u("initial")}}),"join"===l&&Object(a.jsx)(V,{onJoin:function(e,t){return n(e,t)},onGoBack:function(){return u("initial")}})]})})),Q=n(218),X=n(219),Z=n(248),$=n(115),ee=n(222),te=n(220),ne=n(221),ae=Object(F.a)((function(e){return{grow:{flexGrow:1},appbar:{flex:"0 0 auto"},chip:{marginRight:e.spacing(1)}}})),re=Object(u.a)((function(){var e=G().applicationStore,t=e.nav,n=e.username,o=e.leaveRoom,i=e.closeRoom,s=e.room,c=e.guests,l=ae(),u=Object(r.useState)(null),d=Object(R.a)(u,2),p=d[0],h=d[1];return Object(a.jsx)(Q.a,{position:"static",className:l.appbar,children:Object(a.jsxs)(X.a,{children:[Object(a.jsx)(Z.a,{icon:Object(a.jsx)(te.a,{}),label:"".concat(null===s||void 0===s?void 0:s.name),className:l.chip}),"guest"===t&&Object(a.jsx)(Z.a,{icon:Object(a.jsx)(ne.a,{}),label:"".concat(n),className:l.chip}),"host"===t&&Object(a.jsx)(Z.a,{icon:Object(a.jsx)(ne.a,{}),label:"".concat(c),className:l.chip}),Object(a.jsx)("div",{className:l.grow}),s&&Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)(D.a,{color:"inherit","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){return h(e.currentTarget)},children:["Code: ",s.code]}),Object(a.jsx)($.a,{anchorEl:p,keepMounted:!0,open:Boolean(p),onClose:function(){return h(null)},children:Object(a.jsxs)(ee.a,{onClick:"guest"===t?o:i,children:["guest"===t?"Leave":"Close"," room"]})})]})]})})})),oe=n(223),ie=n(224),se=n(64),ce=n(225),le=n(229),ue=n(120),de=n(217),pe=n(172),he=n(230),je=n(249),me=n(231),ve=n(232),be=n(233),fe=n(234),ge=n(235),xe=n(244),Oe=n(237),ye=n(238),ke=n(243),we=n(226),_e=n(227),Se=n(228),Me=n(236),Ne=Object(F.a)((function(e){return{container:{flex:"1 1 auto",overflow:"hidden"},box:{height:"100%",overflow:"hidden",paddingTop:e.spacing(3)},paper:{padding:e.spacing(3),height:"100%",overflow:"hidden"},songspaper:{padding:e.spacing(3),height:"100%",overflow:"hidden",display:"flex",flexDirection:"column"},root:{display:"flex",flexGrow:"1"},details:{display:"flex",flex:"1 1 auto",flexDirection:"column"},content:{flex:"1 0 auto"},cover:{width:151},controls:{display:"flex",alignItems:"center",paddingLeft:e.spacing(1),paddingBottom:e.spacing(1)},playIcon:{height:38,width:38},gridRoot:{height:"100%",flexWrap:"unset"},flexshrink:{flex:"0 0 auto"},playlistscontainer:{overflow:"hidden",flex:"1 1 auto"},playlists:{width:"100%",height:"100%",overflow:"scroll"},playlist:{cursor:"pointer","&:hover":{background:e.palette.background.default}},songs:{overflow:"scroll",width:"100%",flex:"1 1 auto"},tabs:{flex:"0 0 auto"},song:{cursor:"pointer","&:hover":{background:e.palette.background.default}},card:{background:"#f0f0f0",height:"100%"},memories:{overflowY:"auto",marginTop:".5rem"},image:{height:"10rem"},selectedSong:{marginTop:".5rem"},selectedSongText:{marginRight:".5rem"}}})),Ce=Object(u.a)((function(){var e,t=Ne(),n=G().spotifyStore,r=n.paused,o=n.current_song,i=n.togglePlayback,s=n.nextSong;return o?Object(a.jsxs)(oe.a,{className:t.root,children:[Object(a.jsxs)("div",{className:t.details,children:[Object(a.jsxs)(ie.a,{className:t.content,children:[Object(a.jsx)(se.a,{component:"h5",variant:"h5",children:(null===o||void 0===o?void 0:o.title)||""}),Object(a.jsx)(se.a,{variant:"subtitle1",color:"textSecondary",children:(null===o||void 0===o||null===(e=o.artists)||void 0===e?void 0:e.join(", "))||""})]}),Object(a.jsxs)("div",{className:t.controls,children:[Object(a.jsx)(ce.a,{"aria-label":"play/pause",disabled:!o,onClick:i,children:r?Object(a.jsx)(we.a,{className:t.playIcon}):Object(a.jsx)(_e.a,{className:t.playIcon})}),Object(a.jsx)(ce.a,{"aria-label":"next",disabled:!o,onClick:s,children:Object(a.jsx)(Se.a,{})})]})]}),Object(a.jsx)(le.a,{className:t.cover,image:(null===o||void 0===o?void 0:o.img)||"",title:"Album cover"})]}):null})),Pe=Object(u.a)((function(){var e=G().spotifyStore,t=e.playlists,n=e.setPlaylist,r=Ne();return Object(a.jsx)(ue.a,{className:r.paper,children:Object(a.jsx)(de.a,{className:r.playlists,children:t.map((function(e,t){return Object(a.jsxs)("div",{children:[Object(a.jsxs)(pe.a,{alignItems:"flex-start",className:r.playlist,children:[Object(a.jsx)(he.a,{children:Object(a.jsx)(je.a,{alt:"",src:(null===e||void 0===e?void 0:e.img)||""})}),Object(a.jsx)(me.a,{primary:(null===e||void 0===e?void 0:e.title)||"",secondary:Object(a.jsx)(a.Fragment,{children:(null===e||void 0===e?void 0:e.owner)||""})}),Object(a.jsx)(ve.a,{children:Object(a.jsx)(D.a,{color:"primary",onClick:function(){return n(null===e||void 0===e?void 0:e.id)},children:"Select"})})]}),Object(a.jsx)(be.a,{variant:"inset",component:"li"})]},(null===e||void 0===e?void 0:e.id)||t)}))})})})),Ee=Object(u.a)((function(){var e=G(),t=e.applicationStore,n=t.memories,r=t.deleteMemory,o=t.selectedSong,i=t.setSelectedSong,s=e.spotifyStore.current_song,c=Ne(),l=n.filter((function(e){return e.song_id===((null===o||void 0===o?void 0:o.id)||(null===s||void 0===s?void 0:s.id))}));return Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{children:o?Object(a.jsxs)(W.a,{container:!0,className:c.selectedSong,children:[Object(a.jsxs)(se.a,{variant:"h5",className:c.selectedSongText,children:["Memories for selected song:"," "]}),Object(a.jsx)(Z.a,{color:"secondary",label:(null===o||void 0===o?void 0:o.title)||"Selected song",avatar:Object(a.jsx)(je.a,{children:"S"}),onDelete:function(){i()}})]}):Object(a.jsx)(se.a,{variant:"h5",className:c.selectedSong,children:"Memories for current song: ".concat((null===s||void 0===s?void 0:s.title)||"-")})}),Object(a.jsx)(W.a,{container:!0,spacing:2,className:c.memories,children:l.map((function(e,t){return Object(a.jsx)(W.a,{item:!0,xs:4,children:Object(a.jsxs)(oe.a,{className:c.card,children:[Object(a.jsxs)(fe.a,{children:[Object(a.jsx)(le.a,{className:c.image,square:!0,image:(null===e||void 0===e?void 0:e.downloadUrl)||"",title:"Memory"}),Object(a.jsxs)(ie.a,{children:[Object(a.jsx)(se.a,{gutterBottom:!0,variant:"h5",component:"h2",children:(null===e||void 0===e?void 0:e.user)||"-"}),Object(a.jsx)(se.a,{variant:"body2",color:"textSecondary",component:"p",children:(null===e||void 0===e?void 0:e.text)||"-"})]})]}),Object(a.jsx)(ge.a,{children:Object(a.jsx)(D.a,{size:"small",color:"primary",onClick:function(){return r(null===e||void 0===e?void 0:e.pk)},children:"Remove"})})]})},(null===e||void 0===e?void 0:e.id)||t)}))})]})})),Ge=Object(u.a)((function(e){var t=e.onSelectSong,n=G(),r=n.applicationStore,o=r.memories,i=r.setSelectedSong,s=n.spotifyStore,c=s.songs,l=s.playSong,u=s.queueSong,d=Ne();return Object(a.jsx)(de.a,{className:d.songs,children:c.map((function(e,n){var r,s;return Object(a.jsxs)("div",{children:[Object(a.jsxs)(pe.a,{alignItems:"flex-start",className:d.song,children:[Object(a.jsx)(he.a,{children:Object(a.jsx)(je.a,{alt:"",src:(null===e||void 0===e?void 0:e.img)||""})}),Object(a.jsx)(me.a,{primary:(null===e||void 0===e?void 0:e.title)||"",secondary:Object(a.jsx)(a.Fragment,{children:(null===e||void 0===e||null===(r=e.artists)||void 0===r?void 0:r.join(", "))||""})}),Object(a.jsxs)(ve.a,{children:[Object(a.jsx)(Z.a,{color:"secondary",label:"".concat(null===o||void 0===o||null===(s=o.filter((function(t){return(null===t||void 0===t?void 0:t.song_id)===(null===e||void 0===e?void 0:e.id)})))||void 0===s?void 0:s.length),onClick:function(){i(null===e||void 0===e?void 0:e.id),t()}}),Object(a.jsx)(ce.a,{"aria-label":"play",onClick:function(){return l(null===e||void 0===e?void 0:e.uri)},children:Object(a.jsx)(we.a,{})}),Object(a.jsx)(ce.a,{"aria-label":"queue",onClick:function(){return u(null===e||void 0===e?void 0:e.uri)},children:Object(a.jsx)(Me.a,{})})]})]}),Object(a.jsx)(be.a,{variant:"inset",component:"li"})]},(null===e||void 0===e?void 0:e.id)||n)}))})})),Re=Object(u.a)((function(){var e=G().spotifyStore.playlist,t=Ne(),n=Object(r.useState)(0),o=Object(R.a)(n,2),i=o[0],s=o[1];return Object(a.jsxs)(ue.a,{className:t.songspaper,children:[Object(a.jsx)(se.a,{component:"h5",variant:"h5",children:"".concat((null===e||void 0===e?void 0:e.title)||"")}),Object(a.jsxs)(xe.a,{className:t.tabs,value:i,onChange:function(e,t){return s(t)},"aria-label":"tabs",variant:"fullWidth",children:[Object(a.jsx)(Oe.a,{label:"Play or queue songs",id:"songs"}),Object(a.jsx)(Oe.a,{label:"Memories",id:"memories"})]}),0===i&&Object(a.jsx)(Ge,{onSelectSong:function(){return s(1)}}),1===i&&Object(a.jsx)(Ee,{})]})})),ze=Object(u.a)((function(){var e=G().spotifyStore.playlist_id,t=Ne();return Object(a.jsx)(ye.a,{className:t.container,children:Object(a.jsx)(ke.a,{className:t.box,children:Object(a.jsxs)(W.a,{container:!0,spacing:2,direction:"column",className:t.gridRoot,children:[Object(a.jsx)(W.a,{item:!0,xs:12,className:t.flexshrink,children:Object(a.jsx)(Ce,{})}),Object(a.jsx)(W.a,{item:!0,xs:12,className:t.playlistscontainer,children:e?Object(a.jsx)(Re,{}):Object(a.jsx)(Pe,{})})]})})})})),Fe=n(239),Ie=n(113),Ae=Object(F.a)((function(e){return{"@global":{".dropzone":{height:"10rem",minHeight:"unset"},".dropzone .MuiDropzonePreviewList-root":{marginLeft:"-28px",marginTop:"-119px"}},container:{flex:"1 1 auto",overflow:"hidden"},box:{height:"100%",overflow:"hidden",paddingTop:e.spacing(3)},gridRoot:{height:"100%",flexWrap:"unset"},songscontainer:{overflow:"hidden",flex:"1 1 auto"},songspaper:{padding:e.spacing(3),height:"100%",overflow:"hidden",display:"flex",flexDirection:"column"},songs:{overflow:"scroll",width:"100%",flex:"1 1 auto"},song:{cursor:"pointer","&:hover":{background:e.palette.background.default}},noplaylist:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},dialog:Object(z.a)({},e.breakpoints.up("sm"),{width:"34rem"}),dialogcontent:{height:"23rem"},dropzone:{height:"6rem"}}})),Te=Object(u.a)((function(){var e=G(),t=e.applicationStore.openAddMemoryPopup,n=e.spotifyStore,r=n.songs,o=n.playlist,i=Ae();return Object(a.jsxs)(de.a,{className:i.songs,children:[Object(a.jsx)(se.a,{component:"h5",variant:"h5",children:"".concat((null===o||void 0===o?void 0:o.title)||"")}),r.map((function(e,n){var r;return Object(a.jsxs)("div",{children:[Object(a.jsxs)(pe.a,{alignItems:"flex-start",className:i.song,children:[Object(a.jsx)(he.a,{children:Object(a.jsx)(je.a,{alt:"",src:(null===e||void 0===e?void 0:e.img)||""})}),Object(a.jsx)(me.a,{primary:(null===e||void 0===e?void 0:e.title)||"",secondary:Object(a.jsx)(a.Fragment,{children:(null===e||void 0===e||null===(r=e.artists)||void 0===r?void 0:r.join(", "))||""})}),Object(a.jsx)(ve.a,{children:Object(a.jsx)(ce.a,{"aria-label":"add-memory",onClick:function(){return t(null===e||void 0===e?void 0:e.id)},children:Object(a.jsx)(Fe.a,{})})})]}),Object(a.jsx)(be.a,{variant:"inset",component:"li"})]},(null===e||void 0===e?void 0:e.id)||n)}))]})})),Be=function(){var e=Ae();return Object(a.jsx)("div",{className:e.noplaylist,children:Object(a.jsx)(se.a,{variant:"subtitle1",children:"The host is still choosing a playlist"})})},De=Object(u.a)((function(){var e,t=G().applicationStore,n=t.selectedSong,o=t.closeAddMemoryPopup,i=t.addMemory,s=Ae(),c=q(),l=Object(r.useState)({}),u=Object(R.a)(l,2),d=u[0],p=u[1],v=function(){var e=Object(j.a)(h.a.mark((function e(t){var n,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(R.a)(t,1),a=n[0]){e.next=3;break}return e.abrupt("return");case 3:p(Object(m.a)(Object(m.a)({},d),{},{file:a}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.jsxs)(I.a,{onClose:function(){},open:!0,fullScreen:"mobile"===c,classes:{paper:s.dialog},children:[Object(a.jsxs)(B.a,{children:["Add memory to song: ",(null===n||void 0===n?void 0:n.title)||""]}),Object(a.jsxs)(A.a,{className:s.dialogcontent,children:[Object(a.jsx)(W.a,{container:!0,spacing:2,children:Object(a.jsx)(W.a,{item:!0,xs:12,children:Object(a.jsx)(L.a,{fullWidth:!0,variant:"outlined",multiline:!0,rows:7,label:"Memory",onChange:function(e){p(Object(m.a)(Object(m.a)({},d),{},{text:"".concat(e.target.value).substr(0,300)}))},value:(null===d||void 0===d?void 0:d.text)||""})})}),Object(a.jsx)(W.a,{container:!0,spacing:2,children:Object(a.jsx)(W.a,{item:!0,xs:12,children:Object(a.jsx)(Ie.a,{dropzoneClass:"dropzone",onChange:v,filesLimit:1,acceptedFiles:["image/*"],dropzoneText:"Upload an image"})})})]}),Object(a.jsx)(T.a,{children:Object(a.jsxs)(W.a,{container:!0,spacing:2,children:[Object(a.jsx)(W.a,{item:!0,xs:6,children:Object(a.jsx)(D.a,{fullWidth:!0,size:"medium",color:"secondary",variant:"contained",onClick:o,children:"Cancel"})}),Object(a.jsx)(W.a,{item:!0,xs:6,children:Object(a.jsx)(D.a,{fullWidth:!0,disabled:!(null===d||void 0===d?void 0:d.file)||(null===d||void 0===d||null===(e=d.text)||void 0===e?void 0:e.length)<10,size:"medium",color:"primary",variant:"contained",onClick:function(){i(d),o()},children:"Send"})})]})})]})})),We=Object(u.a)((function(){var e=G(),t=e.applicationStore.popup,n=e.spotifyStore.songs,r=Ae();return Object(a.jsxs)(a.Fragment,{children:["addMemory"===t&&Object(a.jsx)(De,{}),Object(a.jsx)(ye.a,{className:r.container,children:Object(a.jsx)(ke.a,{className:r.box,children:Object(a.jsx)(W.a,{container:!0,spacing:2,direction:"column",className:r.gridRoot,children:Object(a.jsx)(W.a,{item:!0,xs:12,className:r.songscontainer,children:Object(a.jsx)(ue.a,{className:r.songspaper,children:(null===n||void 0===n?void 0:n.length)?Object(a.jsx)(Te,{}):Object(a.jsx)(Be,{})})})})})})]})})),Le=Object(u.a)((function(){var e=G().applicationStore,t=e.initialize,n=e.nav;return Object(r.useEffect)((function(){t()}),[t]),Object(a.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100vh",width:"100vw",overflow:"hidden"},children:[Object(a.jsxs)(d.a,{children:[Object(a.jsx)("meta",{charSet:"utf-8"}),Object(a.jsx)("meta",{name:"theme-color",content:"#237fb1"}),Object(a.jsx)("title",{children:"Playlist Memories"})]}),"landing_page"!==n&&Object(a.jsx)(re,{}),"landing_page"===n&&Object(a.jsx)(Y,{}),"host"===n&&Object(a.jsx)(ze,{}),"guest"===n&&Object(a.jsx)(We,{})]})})),Je=n(112),qe=Object(Je.a)({palette:{type:"light",primary:{main:"#5F4B8BFF",contrastText:"#fefefe"},secondary:{main:"#E69A8DFF",contrastText:"#fefefe"},red:{main:"#ff0000"},error:{main:"#ab3030"},background:{default:"#f0f0f0"}}});i.a.render(Object(a.jsxs)(c.a,{theme:qe,children:[Object(a.jsx)(s.a,{}),Object(a.jsx)(l.a,{maxSnack:3,children:Object(a.jsx)(Le,{})})]}),document.getElementById("root"))}},[[170,1,2]]]);
//# sourceMappingURL=main.12d46e16.chunk.js.map